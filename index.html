<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>❤️</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: #ff0040; 
            font-family: 'Courier New', Courier, monospace; 
            overflow: hidden; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            user-select: none; 
        }

        #canvas-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .content {
            position: relative;
            z-index: 10;
            text-align: center;
            pointer-events: none; 
        }

        #heart-ascii {
            font-size: 12px;
            line-height: 12px;
            white-space: pre; 
            font-weight: bold;
        }

        .caption {
            margin-top: 10px;
            font-size: 1.5rem;
            color: #fff;
            text-shadow: 0 0 10px #ff0040;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0.8; transform: scale(1); }
        }

        @media (max-width: 600px) {
            #heart-ascii {
                font-size: 8px; 
                line-height: 8px;
            }
            .caption {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>

    <canvas id="canvas-bg"></canvas>

    <div class="content">
        <div id="heart-ascii"></div>
        <div class="caption">С Днем Святого Валентина!</div>
    </div>

  <script>
        const preTag = document.getElementById('heart-ascii');

        // Настройки
        const X_SCALE = 35;  // Ширина
        const Y_SCALE = 20;  // Высота (чуть меньше, чтобы не вылезало)
        
        const CHARS = "@@##==++::..  "; 

        let points = []; 
        let A = 0; 

        // ГЕНЕРАЦИЯ
        function initHeart() {
            // x - ширина
            // y - толщина 
            // z - высота 
            
            for (let z = -1.3; z <= 1.3; z += 0.04) {       // Высота 
                for (let x = -1.3; x <= 1.3; x += 0.04) {   // Ширина
                     // y - толщина
                    for (let y = -0.6; y <= 0.6; y += 0.04) { 
                        
                        let a = x * x + (9/4) * y * y + z * z - 1;
                        
                        // Проверяем принадлежность точки сердцу
                        if (a * a * a - x * x * z * z * z - (9/80) * y * y * z * z * z <= 0) {
                            
                            //ПЕРЕВОРОТ ОСЕЙ
                            points.push({
                                x: x,       // X остается X
                                y: -z,      // Z становится Y 
                                z: y        // Y становится Z 
                            });
                        }
                    }
                }
            }
        }

        // ОТРИСОВКА 
        function renderHeart() {
            const width = 40;  
            const height = 40; 
            
            let zBuffer = new Array(width * height).fill(0);
            let b = new Array(width * height).fill(' ');

            let c = Math.cos(A);
            let s = Math.sin(A);

            for (let i = 0; i < points.length; i++) {
                let p = points[i];
                
                // Вращение вокруг Y (вертикальной оси)
                // Так как мы уже поменяли оси местами в initHeart,
                let rx = p.x * c - p.z * s;
                let rz = p.x * s + p.z * c;
                let ry = p.y; 

                // Перспектива
                let fov = 100; 
                let ooz = 1 / (fov + rz * 20); 

                // Проекция
                let xp = Math.floor(width / 2 + rx * ooz * width * X_SCALE); 
                let yp = Math.floor(height / 2 + ry * ooz * height * Y_SCALE); // + ry, т.к. ось Y инвертирована

                let idx = xp + width * yp;
                
                if (idx >= 0 && idx < width * height) {
                    if (ooz > zBuffer[idx]) {
                        zBuffer[idx] = ooz;
                        
                        // Освещение
                        let light = (rz + 0.5) * 1.5; 
                        
                        let charIdx = Math.floor(light * (CHARS.length - 1));
                        if (charIdx < 0) charIdx = 0;
                        if (charIdx >= CHARS.length) charIdx = CHARS.length - 1;

                        b[idx] = CHARS[charIdx];
                    }
                }
            }

            let txt = "";
            for (let i = 0; i < height; i++) {
                for (let j = 0; j < width; j++) {
                    txt += b[i * width + j];
                }
                txt += "\n";
            }
            preTag.innerText = txt;
            
            A += 0.07; 
        }

        initHeart(); 
        setInterval(renderHeart, 30);

        const canvas = document.getElementById('canvas-bg');
        const ctx = canvas.getContext('2d');
        let cWidth, cHeight;
        let particles = [];
        let clickParticles = [];
        function resize() { cWidth = canvas.width = window.innerWidth; cHeight = canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize); resize();
        class Particle {
            constructor() { this.x = Math.random() * cWidth; this.y = Math.random() * cHeight; this.vx = (Math.random() - 0.5) * 0.5; this.vy = (Math.random() - 0.5) * 0.5; this.size = Math.random() * 2; this.alpha = Math.random() * 0.5 + 0.1; }
            update() { this.x += this.vx; this.y += this.vy; if(this.x < 0) this.x = cWidth; if(this.x > cWidth) this.x = 0; if(this.y < 0) this.y = cHeight; if(this.y > cHeight) this.y = 0; }
            draw() { ctx.globalAlpha = this.alpha; ctx.fillStyle = '#ff6666'; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill(); }
        }
        class HeartParticle {
            constructor(x, y) { this.x = x; this.y = y; const a = Math.random() * Math.PI * 2; const s = Math.random() * 3 + 2; this.vx = Math.cos(a) * s; this.vy = Math.sin(a) * s; this.g = 0.05; this.l = 1; this.d = Math.random() * 0.02 + 0.01; this.sz = Math.random() * 15 + 10; }
            update() { this.x += this.vx; this.y += this.vy; this.vy += this.g; this.l -= this.d; }
            draw() { ctx.globalAlpha = this.l; ctx.font = `${this.sz}px serif`; ctx.fillStyle = '#ff0040'; ctx.fillText('♥', this.x, this.y); }
        }
        for (let i = 0; i < 50; i++) particles.push(new Particle());
        function animateCanvas() {
            ctx.clearRect(0, 0, cWidth, cHeight);
            particles.forEach(p => { p.update(); p.draw(); });
            for (let i = clickParticles.length - 1; i >= 0; i--) { let p = clickParticles[i]; p.update(); p.draw(); if (p.l <= 0) clickParticles.splice(i, 1); }
            requestAnimationFrame(animateCanvas);
        }
        animateCanvas();
        const addHearts = (x, y) => { for(let i=0; i<15; i++) clickParticles.push(new HeartParticle(x, y)); };
        window.addEventListener('mousedown', (e) => { const r = canvas.getBoundingClientRect(); addHearts(e.clientX - r.left, e.clientY - r.top); });
        window.addEventListener('touchstart', (e) => { const r = canvas.getBoundingClientRect(); addHearts(e.touches[0].clientX - r.left, e.touches[0].clientY - r.top); });
    </script>
</body>
</html>